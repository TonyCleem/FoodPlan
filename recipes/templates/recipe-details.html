{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
        crossorigin="anonymous">
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <title>FoodPlan ‚Äî –í—ã–±–æ—Ä –±–ª—é–¥–∞</title>
</head>
<body>
  <header>
    <nav class="navbar navbar-light fixed-top navbar__opacity">
      <div class="container">
        <a class="navbar-brand" href="{% url 'recipes:index' %}">
          <img src="{% static 'img/logo.8d8f24edbb5f.svg' %}" height="55"
               width="189" alt="FoodPlan">
        </a>
        {% if user.is_authenticated %}
          <a href="{% url 'recipes:lk' %}"
             class="btn shadow-none btn-outline-success foodplan_green foodplan__border_green me-2">
            –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
          </a>
          <a href="{% url 'recipes:logout' %}"
             class="btn shadow-none btn-outline-success foodplan_green foodplan__border_green">
            –í—ã–π—Ç–∏
          </a>
        {% else %}
          <a href="{% url 'recipes:login' %}?next={% url 'recipes:recipe_details' %}"
             class="btn shadow-none btn-outline-success foodplan_green foodplan__border_green">
            –í–æ–π—Ç–∏
          </a>
        {% endif %}
      </div>
    </nav>
  </header>
  <main style="margin-top: calc(2rem + 85px);">
    <section>
      <div class="container">
        {% if error %}
          <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"
                    aria-label="Close"></button>
          </div>
        {% endif %}
        {% if recipe %}
          <div class="row">
            <div class="col-12 col-md-4 d-flex justify-content-center">
              <div class="card foodplan__card_borderless">
                <img src="{{ recipe.image.url|default:'/static/img/circle1.png' }}"
                     alt="{{ recipe.name }}" class="card-img-top"
                     style="height: 250px; object-fit: cover;">
              </div>
            </div>
            <div class="col-12 col-md-8 d-flex flex-column justify-content-between">
              <h2 class="mb-3">{{ recipe.name }}</h2>
              <div class="mb-3">
                <h6><strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong></h6>
                <ul class="list-group list-group-flush">
                  {% for ingredient in recipe.ingredients.all %}
                    <li class="list-group-item d-flex justify-content-between">
                      <span>{{ ingredient.name }} ({{ ingredient.weight }}–≥)</span>
                      <span class="text-success fw-bold">{{ ingredient.cost }}‚ÇΩ</span>
                    </li>
                  {% endfor %}
                </ul>
              </div>
              <div class="row mb-4">
                <div class="col-6">
                  <h6 class="text-primary">–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å:
                    <span class="fw-bold">{{ recipe.calories }} –∫–∫–∞–ª</span>
                  </h6>
                </div>
                <div class="col-6">
                  <h6 class="text-success">–°—Ç–æ–∏–º–æ—Å—Ç—å:
                    <span class="fw-bold">{{ recipe.total_cost }}‚ÇΩ</span>
                  </h6>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-6">
                  <h6>–¢–∏–ø: {{ recipe.get_dish_type_display }}</h6>
                </div>
                <div class="col-6">
                  <h6>–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ:
                    {% if recipe.is_vegetarian %}‚úÖ –î–∞{% else %}‚ùå –ù–µ—Ç{% endif %}
                  </h6>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded">
                <form method="POST" action="{% url 'recipes:dislike_recipe' recipe.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-outline-danger btn-lg">
                    <i class="bi bi-x-lg me-2"></i>–î–∏–∑–ª–∞–π–∫
                  </button>
                </form>
                {% if user.is_authenticated %}
                  <form method="POST" action="{% url 'recipes:like_recipe' recipe.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-lg">
                      <i class="bi bi-heart-fill me-2"></i>–õ–∞–π–∫
                    </button>
                  </form>
                {% else %}
                  <a href="{% url 'recipes:login' %}?next={% url 'recipes:recipe_details' %}"
                     class="btn btn-success btn-lg">
                    <i class="bi bi-heart me-2"></i>–õ–∞–π–∫ (–í–æ–π—Ç–∏)
                  </a>
                {% endif %}
              </div>
              <button class="btn btn-outline-primary mt-3" data-bs-toggle="collapse"
                      data-bs-target="#filters">üîç –§–∏–ª—å—Ç—Ä—ã</button>
              <div class="collapse mt-3" id="filters">
                {% if user.is_authenticated %}
                  <form id="filter-form" method="POST"
                        action="{% url 'recipes:apply_filters' %}">
                    {% csrf_token %}
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="low_calorie"
                             name="low_calorie" {% if filters.low_calorie %}checked{% endif %}>
                      <label class="form-check-label" for="low_calorie">
                        –ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ (<500 –∫–∫–∞–ª)
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="is_vegetarian"
                             name="is_vegetarian" {% if filters.is_vegetarian %}checked{% endif %}>
                      <label class="form-check-label" for="is_vegetarian">
                        –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="no_gluten"
                             name="no_gluten" {% if filters.no_gluten %}checked{% endif %}>
                      <label class="form-check-label" for="no_gluten">
                        –ë–µ–∑ –≥–ª—é—Ç–µ–Ω–∞
                      </label>
                    </div>
                    <div class="form-group">
                      <label for="dish_type">–¢–∏–ø –±–ª—é–¥–∞</label>
                      <select class="form-control" id="dish_type" name="dish_type">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        {% for value, label in dish_types %}
                          <option value="{{ value }}"
                                  {% if filters.dish_type == value %}selected{% endif %}>
                            {{ label }}
                          </option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="max_cost">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                      <input type="number" class="form-control" id="max_cost"
                             name="max_cost" step="0.01"
                             value="{{ filters.max_cost|default_if_none:'' }}"
                             placeholder="500">
                    </div>
                    <button type="submit"
                            class="btn btn-success w-100 foodplan_green foodplan__border_green mt-3">
                      <i class="bi bi-funnel me-2"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                  </form>
                {% else %}
                  <div class="text-center py-4">
                    <p>
                      –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã,
                      <a href="{% url 'recipes:login' %}?next={% url 'recipes:recipe_details' %}">
                        –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
                      </a>.
                    </p>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% else %}
          <div class="text-center py-5">
            <h3>–ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p class="text-muted">
              –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏
              <a href="{% url 'recipes:recipe_details_reset' %}" class="link-success fw-bold">
                –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
              </a>
            </p>
          </div>
        {% endif %}
      </div>
    </section>
  </main>
  <footer class="footer py-4 mt-5" style="border-top: 1px solid lightgray;">
    <div class="container d-flex flex-row justify-content-between mb-2">
      <a href="https://vk.com/devmanorg">
        <img src="{% static 'img/vk.png' %}" height="40" width="auto" alt="VK">
      </a>
      <div>
        <a href="#" class="link-dark mx-1" style="text-decoration: none;">
          <b>–í–∏–¥—ã –º–µ–Ω—é</b>
        </a>
        <a href="#" class="link-dark mx-1" style="text-decoration: none;">
          <b>–ë–ª–æ–≥</b>
        </a>
        <a href="#" class="link-dark mx-1" style="text-decoration: none;">
          <b>–ö–æ–Ω—Ç–∞–∫—Ç—ã</b>
        </a>
      </div>
    </div>
    <div class="container">
      <h6 class="link-secondary text-center">
        <a href="#" class="link-secondary me-2">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
        <a href="#" class="link-secondary">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
      </h6>
      <h6 class="link-secondary text-center">¬© Devman 2022. All right reserved.</h6>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
</body>
</html>